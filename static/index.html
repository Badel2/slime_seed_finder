<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>slime_seed_finder playground</title>
        <style>
            body {
                background-color: #eee;
            }
            input {
                font-family: monospace;
            }
            textarea {
                font-family: monospace;
            }
            #chunks, #no_chunks, #output_textarea {
                width: 30%;
            }
            #chunks {
                background-color: #ded;
            }
            #no_chunks {
                background-color: #edd;
            }
        </style>
    </head>
    <body>
        <div>
          <button id="comphdl_start" onClick="runGui()">RUN!</button>
        </div>
        List all the slime chunks in the green text area, and all the non slime chunks
        in the red text area.
        <div>
          <textarea id="chunks" class="code" rows="20"></textarea>
          <textarea id="no_chunks" class="code" rows="20"></textarea>
          <textarea id="output_textarea" class="code" rows="20" readonly>Found 48-bit seeds will appear here.</textarea>
        </div>
        <textarea id="num_candidates" class="code" rows="1" readonly></textarea>

        <div>
          <br>
          Once you have found the lower 48 bits of the seed, you can find the full 64 bit seed by
          assuming that it was generated by Minecraft when the seed field is left empty
          (using Rand.nextLong()). <br>
          <input type="text" id="seed48" placeholder="Enter the lowest 48 bits of the seed here (in decimal)">
          <br>
          <textarea id="output_extend48" class="code" rows="3" readonly>Found 64-bit seeds will appear here.</textarea>
        </div>
          
        <script type="text/javascript" src="wasm_gui.js"></script>
        <script>
            if (window.Worker) {
                var myWorker = new Worker("worker.js");
            }
            function runGui() {
                    var chunks = document.getElementById('chunks').value;
                    var no_chunks = document.getElementById('no_chunks').value;
                    var outta = document.getElementById('output_textarea');
                    outta.value = "Calculating...";
                    if (window.Worker) {
                        myWorker.postMessage({ chunks: chunks, no_chunks: no_chunks });
                        console.log('Message posted to worker');
                        myWorker.onmessage = function(e) {
                            outta.value = e.data;
                            console.log('Got message from worker');
                        };
                    } else {
                        Rust.wasm_gui.then( function( wasmgui ) {
                            // TODO: check if a thread is already running and kill it
                            outta.value = wasmgui.slime_seed_finder(chunks, no_chunks);
                        }, function( err ) {
                            console.err(err);
                        });
                    }
            }

            // Count candidates
            Rust.wasm_gui.then( function( wasmgui ) {
                var chunks = document.getElementById('chunks');
                var no_chunks = document.getElementById('no_chunks');
                var outta = document.getElementById('num_candidates');
                chunks.addEventListener( "keyup", function( event ) {
                    outta.value = wasmgui.count_candidates({ chunks: chunks.value, no_chunks: no_chunks.value });
                });
                no_chunks.addEventListener( "keyup", function( event ) {
                    outta.value = wasmgui.count_candidates({ chunks: chunks.value, no_chunks: no_chunks.value });
                });
            }, function( err ) {
                console.err(err);
            });

            // Extend 48
            Rust.wasm_gui.then( function( wasmgui ) {
                var seed48 = document.getElementById('seed48');
                var outta = document.getElementById('output_extend48');
                seed48.addEventListener( "keyup", function( event ) {
                    outta.value = wasmgui.extend48(seed48.value);
                });
            }, function( err ) {
                console.err(err);
            });
        </script>
    </body>
</html>
